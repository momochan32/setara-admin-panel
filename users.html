<?php
// SETARA Users Data - Dummy Data for Thalassemia Patients
$usersData = [
    [
        'photo' => 'user-list1.png',
        'name' => 'Aisyah Putri',
        'email' => 'aisyah.putri@email.com',
        'thalassemiaType' => 'Thalassemia Mayor',
        'currentLevel' => 'Warrior',
        'totalPoints' => 1250,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2018,
        'bloodType' => 'B+',
        'emergencyContactName' => 'Ibu Siti Aminah',
        'emergencyContactPhone' => '+62 812-3456-7890',
        'emergencyContactRelation' => 'Ibu Kandung'
    ],
    [
        'photo' => 'user-list2.png',
        'name' => 'Rizky Pratama',
        'email' => 'rizky.pratama@email.com',
        'thalassemiaType' => 'Thalassemia Minor',
        'currentLevel' => 'Champion',
        'totalPoints' => 2100,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2016,
        'bloodType' => 'O+',
        'emergencyContactName' => 'Ayah Budi Santoso',
        'emergencyContactPhone' => '+62 813-9876-5432',
        'emergencyContactRelation' => 'Ayah Kandung'
    ],
    [
        'photo' => 'user-list3.png',
        'name' => 'Siti Nurhaliza',
        'email' => 'siti.nur@email.com',
        'thalassemiaType' => 'Thalassemia Mayor',
        'currentLevel' => 'Hero',
        'totalPoints' => 3500,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2015,
        'bloodType' => 'A+',
        'emergencyContactName' => 'Ibu Fatimah',
        'emergencyContactPhone' => '+62 815-1234-5678',
        'emergencyContactRelation' => 'Ibu Kandung'
    ],
    [
        'photo' => 'user-list4.png',
        'name' => 'Budi Santoso',
        'email' => 'budi.santoso@email.com',
        'thalassemiaType' => 'Thalassemia Minor',
        'currentLevel' => 'Beginner',
        'totalPoints' => 450,
        'status' => 'Inactive',
        'statusClass' => 'bg-neutral-200 text-neutral-600 border border-neutral-400',
        'diagnosisYear' => 2020,
        'bloodType' => 'AB+',
        'emergencyContactName' => 'Kakak Dewi Lestari',
        'emergencyContactPhone' => '+62 817-2468-1357',
        'emergencyContactRelation' => 'Kakak Kandung'
    ],
    [
        'photo' => 'user-list5.png',
        'name' => 'Dewi Lestari',
        'email' => 'dewi.lestari@email.com',
        'thalassemiaType' => 'Thalassemia Mayor',
        'currentLevel' => 'Warrior',
        'totalPoints' => 1680,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2017,
        'bloodType' => 'B-',
        'emergencyContactName' => 'Ibu Sri Wahyuni',
        'emergencyContactPhone' => '+62 819-8765-4321',
        'emergencyContactRelation' => 'Ibu Kandung'
    ],
    [
        'photo' => 'user-list6.png',
        'name' => 'Ahmad Fauzi',
        'email' => 'ahmad.fauzi@email.com',
        'thalassemiaType' => 'Thalassemia Minor',
        'currentLevel' => 'Champion',
        'totalPoints' => 2450,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2019,
        'bloodType' => 'O-',
        'emergencyContactName' => 'Ayah Ahmad Yusuf',
        'emergencyContactPhone' => '+62 821-5555-6666',
        'emergencyContactRelation' => 'Ayah Kandung'
    ],
    [
        'photo' => 'user-list7.png',
        'name' => 'Intan Permata',
        'email' => 'intan.permata@email.com',
        'thalassemiaType' => 'Thalassemia Mayor',
        'currentLevel' => 'Beginner',
        'totalPoints' => 320,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2021,
        'bloodType' => 'A-',
        'emergencyContactName' => 'Ibu Rina Susanti',
        'emergencyContactPhone' => '+62 822-7777-8888',
        'emergencyContactRelation' => 'Ibu Kandung'
    ],
    [
        'photo' => 'user-list8.png',
        'name' => 'Hendra Wijaya',
        'email' => 'hendra.wijaya@email.com',
        'thalassemiaType' => 'Thalassemia Minor',
        'currentLevel' => 'Hero',
        'totalPoints' => 4200,
        'status' => 'Active',
        'statusClass' => 'bg-success-focus text-success-600 border border-success-main',
        'diagnosisYear' => 2014,
        'bloodType' => 'AB-',
        'emergencyContactName' => 'Ayah Hendra Gunawan',
        'emergencyContactPhone' => '+62 823-9999-0000',
        'emergencyContactRelation' => 'Ayah Kandung'
    ]
];

$script ='<script>
                        // Remove/Ban User
                        $(".ban-item-btn").on("click", function() {
                            if(confirm("Apakah Anda yakin ingin mem-ban pengguna ini?")) {
                                $(this).closest("tr").addClass("d-none");
                                // TODO: Add Firebase logic to ban user
                            }
                        });

                        // View Detail Modal
                        $(".view-detail-btn").on("click", function() {
                            var userId = $(this).data("user-id");
                            $("#userDetailModal" + userId).modal("show");
                        });
            </script>';?>

<?php include './partials/layouts/layoutTop.php' ?>

        <div class="dashboard-main-body">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
                <h6 class="fw-semibold mb-0">Manajemen Pengguna</h6>
                <ul class="d-flex align-items-center gap-2">
                    <li class="fw-medium">
                        <a href="index.php" class="d-flex align-items-center gap-1 hover-text-primary">
                            <iconify-icon icon="solar:home-smile-angle-outline" class="icon text-lg"></iconify-icon>
                            Dashboard
                        </a>
                    </li>
                    <li>-</li>
                    <li class="fw-medium">Pengguna</li>
                </ul>
            </div>

            <div class="card h-100 p-0 radius-12">
                <div class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
                    <div class="d-flex align-items-center flex-wrap gap-3">
                        <span class="text-md fw-medium text-secondary-light mb-0">Show</span>
                        <select class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px">
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                        </select>
                        <form class="navbar-search">
                            <input type="text" class="bg-base h-40-px w-auto" name="search" placeholder="Cari pengguna...">
                            <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
                        </form>
                        <select class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px">
                            <option value="">Semua Tipe</option>
                            <option value="mayor">Thalassemia Mayor</option>
                            <option value="minor">Thalassemia Minor</option>
                        </select>
                        <select class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px">
                            <option value="">Semua Level</option>
                            <option value="beginner">Beginner</option>
                            <option value="warrior">Warrior</option>
                            <option value="champion">Champion</option>
                            <option value="hero">Hero</option>
                        </select>
                    </div>
                </div>
                <div class="card-body p-24">
                    <div class="table-responsive scroll-sm">
                        <table class="table bordered-table sm-table mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <div class="d-flex align-items-center gap-10">
                                            <div class="form-check style-check d-flex align-items-center">
                                                <input class="form-check-input radius-4 border input-form-dark" type="checkbox" name="checkbox" id="selectAll">
                                            </div>
                                            No
                                        </div>
                                    </th>
                                    <th scope="col">Nama & Foto</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Tipe Thalassemia</th>
                                    <th scope="col">Level</th>
                                    <th scope="col" class="text-center">Total Poin</th>
                                    <th scope="col" class="text-center">Status</th>
                                    <th scope="col" class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($usersData as $index => $user): ?>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-10">
                                            <div class="form-check style-check d-flex align-items-center">
                                                <input class="form-check-input radius-4 border border-neutral-400" type="checkbox" name="checkbox">
                                            </div>
                                            <?php echo str_pad($index + 1, 2, '0', STR_PAD_LEFT); ?>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="assets/images/user-list/<?php echo $user['photo']; ?>" alt="" class="w-40-px h-40-px rounded-circle flex-shrink-0 me-12 overflow-hidden">
                                            <div class="flex-grow-1">
                                                <span class="text-md mb-0 fw-normal text-secondary-light"><?php echo $user['name']; ?></span>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="text-md mb-0 fw-normal text-secondary-light"><?php echo $user['email']; ?></span></td>
                                    <td>
                                        <span class="<?php echo ($user['thalassemiaType'] == 'Thalassemia Mayor') ? 'text-danger-600' : 'text-warning-600'; ?> fw-medium">
                                            <?php echo $user['thalassemiaType']; ?>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary-600 text-white px-12 py-6 radius-4 fw-medium text-sm">
                                            <?php echo $user['currentLevel']; ?>
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <span class="text-primary-600 fw-semibold"><?php echo number_format($user['totalPoints']); ?></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="<?php echo $user['statusClass']; ?> px-24 py-4 radius-4 fw-medium text-sm"><?php echo $user['status']; ?></span>
                                    </td>
                                    <td class="text-center">
                                        <div class="d-flex align-items-center gap-10 justify-content-center">
                                            <button type="button" class="view-detail-btn bg-info-focus bg-hover-info-200 text-info-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" data-user-id="<?php echo $index; ?>" data-bs-toggle="modal" data-bs-target="#userDetailModal<?php echo $index; ?>">
                                                <iconify-icon icon="majesticons:eye-line" class="icon text-xl"></iconify-icon>
                                            </button>
                                            <button type="button" class="ban-item-btn bg-danger-focus bg-hover-danger-200 text-danger-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" title="Ban User">
                                                <iconify-icon icon="material-symbols:block" class="menu-icon"></iconify-icon>
                                            </button>
                                        </div>
                                    </td>
                                </tr>

                                <!-- User Detail Modal -->
                                <div class="modal fade" id="userDetailModal<?php echo $index; ?>" tabindex="-1" aria-labelledby="userDetailModalLabel<?php echo $index; ?>" aria-hidden="true">
                                    <div class="modal-dialog modal-lg modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="userDetailModalLabel<?php echo $index; ?>">Detail Pengguna</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="text-center mb-24">
                                                    <img src="assets/images/user-list/<?php echo $user['photo']; ?>" alt="" class="w-120-px h-120-px rounded-circle mx-auto mb-16">
                                                    <h6 class="mb-4"><?php echo $user['name']; ?></h6>
                                                    <p class="text-secondary-light mb-16"><?php echo $user['email']; ?></p>
                                                </div>

                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Tipe Thalassemia</p>
                                                            <h6 class="mb-0 text-sm"><?php echo $user['thalassemiaType']; ?></h6>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Level Saat Ini</p>
                                                            <h6 class="mb-0 text-sm"><?php echo $user['currentLevel']; ?></h6>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Total Poin</p>
                                                            <h6 class="mb-0 text-sm text-primary-600"><?php echo number_format($user['totalPoints']); ?></h6>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Tahun Diagnosis</p>
                                                            <h6 class="mb-0 text-sm"><?php echo $user['diagnosisYear']; ?></h6>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Golongan Darah</p>
                                                            <h6 class="mb-0 text-sm"><?php echo $user['bloodType']; ?></h6>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="p-16 border radius-8">
                                                            <p class="text-secondary-light mb-4 text-sm">Status</p>
                                                            <span class="<?php echo $user['statusClass']; ?> px-12 py-4 radius-4 fw-medium text-xs"><?php echo $user['status']; ?></span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="mt-20 p-20 border radius-8 bg-warning-focus">
                                                    <h6 class="mb-16 fw-semibold text-md d-flex align-items-center gap-2">
                                                        <iconify-icon icon="solar:phone-calling-bold" class="text-warning-600 text-xl"></iconify-icon>
                                                        Kontak Darurat
                                                    </h6>
                                                    <div class="row g-3">
                                                        <div class="col-md-12">
                                                            <div class="d-flex align-items-center gap-3">
                                                                <iconify-icon icon="solar:user-bold" class="text-warning-600 text-2xl"></iconify-icon>
                                                                <div>
                                                                    <p class="text-xs text-secondary-light mb-4">Nama Kontak</p>
                                                                    <h6 class="mb-0 text-sm"><?php echo $user['emergencyContactName']; ?></h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="d-flex align-items-center gap-3">
                                                                <iconify-icon icon="solar:phone-bold" class="text-warning-600 text-2xl"></iconify-icon>
                                                                <div>
                                                                    <p class="text-xs text-secondary-light mb-4">Nomor Telepon</p>
                                                                    <h6 class="mb-0 text-sm"><?php echo $user['emergencyContactPhone']; ?></h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="d-flex align-items-center gap-3">
                                                                <iconify-icon icon="solar:users-group-rounded-bold" class="text-warning-600 text-2xl"></iconify-icon>
                                                                <div>
                                                                    <p class="text-xs text-secondary-light mb-4">Hubungan</p>
                                                                    <h6 class="mb-0 text-sm"><?php echo $user['emergencyContactRelation']; ?></h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>

                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24">
                        <span>Menampilkan 1 hingga <?php echo count($usersData); ?> dari <?php echo count($usersData); ?> entri</span>
                        <ul class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center">
                            <li class="page-item">
                                <a class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md" href="javascript:void(0)">
                                    <iconify-icon icon="ep:d-arrow-left" class=""></iconify-icon>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md bg-primary-600 text-white" href="javascript:void(0)">1</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md" href="javascript:void(0)">
                                    <iconify-icon icon="ep:d-arrow-right" class=""></iconify-icon>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

<?php include './partials/layouts/layoutBottom.php' ?>
